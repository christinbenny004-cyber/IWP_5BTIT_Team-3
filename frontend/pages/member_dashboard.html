<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Member Dashboard</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<style>
		/* Background */
		body.page-bg {
			min-height: 100vh;
			background-image: url('https://images.unsplash.com/photo-1551836022-d5d88e9218df?auto=format&fit=crop&w=1950&q=80');
			background-size: cover;
			background-position: center;
			background-attachment: fixed;
			position: relative;
		}
		body.page-bg::before {
			content: "";
			position: fixed;
			inset: 0;
			background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.75));
			z-index: -1;
		}

		/* Navbar */
		.navbar {
			backdrop-filter: blur(10px);
			-webkit-backdrop-filter: blur(10px);
			background: rgba(25, 135, 84, 0.9) !important;
			box-shadow: 0 4px 15px rgba(0,0,0,0.3);
		}

		/* Glassmorphic task cards */
		.task-card {
			background: rgba(255,255,255,0.08);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			border: 1px solid rgba(255,255,255,0.15);
			border-radius: 12px;
			box-shadow: 0 6px 20px rgba(0,0,0,0.25);
			color: #f8f9fa;
			transition: transform 0.2s ease, box-shadow 0.2s ease;
		}
		.task-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 10px 25px rgba(0,0,0,0.4);
		}
		.task-card .card-body {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}
		.task-card .small {
			color: #b0bec5;
		}
		.task-card strong {
			color: #fff;
		}
	</style>
</head>
<body class="page-bg">
	<nav class="navbar navbar-dark">
		<div class="container-fluid">
			<a class="navbar-brand fw-bold" href="#">Member Dashboard</a>
			<div class="d-flex gap-2">
				<a class="btn btn-outline-light" href="/pages/update_task.html">Update Tasks</a>
				<button class="btn btn-light" id="logoutBtn">Logout</button>
			</div>
		</div>
	</nav>

	<div class="container my-4" id="tasks"></div>

	<script>
	async function guard(){
		const res = await fetch('/api/auth/me', { credentials:'include' });
		if (!res.ok) { window.location.href='/pages/login.html'; return false; }
		const me = await res.json();
		if (me.role !== 'member' && me.role !== 'admin' && me.role !== 'leader') { window.location.href='/pages/error.html'; return false; }
		return true;
	}
	async function load(){
		const res = await fetch('/api/projects/my-tasks', { credentials:'include' });
		if (!res.ok) { alert('Unauthorized'); window.location.href='/pages/login.html'; return; }
		const list = await res.json();
		document.getElementById('tasks').innerHTML = list.map(t=>`
			<div class='card task-card mb-3'>
				<div class='card-body'>
					<div>
						<div class='small text-muted'>${t.project_title} / ${t.module_name}</div>
						<strong>${t.task_name}</strong>
					</div>
					<div>
						<span class='badge text-bg-secondary'>${t.status}</span>
					</div>
				</div>
			</div>
		`).join('');
	}
	guard().then(ok=>{ if (ok) load(); });
	document.getElementById('logoutBtn').onclick = async ()=>{
		await fetch('/api/auth/logout', { method:'POST', credentials:'include' });
		window.location.href = '/pages/login.html';
	};
	</script>
</body>
</html>
