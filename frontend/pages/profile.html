<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>My Profile</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">
	<link href="/assets/css/templatemo-neural-style.css" rel="stylesheet">
</head>
<body>
	<div class="container my-4">
		<div class="d-flex justify-content-between align-items-center mb-3">
			<h3>My Profile</h3>
			<button class="btn btn-dark" id="logoutBtn">Logout</button>
		</div>
		<div class="row g-2">
			<div class="col-md-4"><input class="form-control" id="name" placeholder="Name"></div>
			<div class="col-md-4"><input class="form-control" id="email" placeholder="Email"></div>
			<div class="col-md-4"><input class="form-control" id="password" placeholder="New Password (optional)"></div>
			<div class="col-12"><button class="btn btn-primary" id="save">Save</button></div>
		</div>
	</div>
	<script>
	async function guard(){
		const res = await fetch('/api/auth/me', { credentials:'include' });
		if (!res.ok) { window.location.href='/pages/login.html'; return false; }
		return true;
	}
	async function load(){
		const res = await fetch('/api/auth/me', { credentials:'include' });
		if (!res.ok) { alert('Unauthorized'); window.location.href='/pages/login.html'; return; }
		const me = await res.json();
		document.getElementById('name').value = me.name || '';
		document.getElementById('email').value = me.email || '';
	}
	document.getElementById('save').onclick = async ()=>{
		const payload = { name: name.value, email: email.value };
		if (password.value) payload.password = password.value;
		const res = await fetch('/api/auth/me', { method:'PUT', headers:{'Content-Type':'application/json'}, credentials:'include', body: JSON.stringify(payload) });
		if (!res.ok) { alert('Failed'); return; }
		alert('Updated');
	};
	document.getElementById('logoutBtn').onclick = async ()=>{
		await fetch('/api/auth/logout', { method:'POST', credentials:'include' });
		window.location.href = '/pages/login.html';
	};
	guard().then(ok=>{ if (ok) load(); });
	</script>
</body>
</html>
