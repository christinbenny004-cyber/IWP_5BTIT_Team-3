<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Leader Progress</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="/assets/css/style.css" rel="stylesheet">
	<link href="/assets/css/templatemo-neural-style.css" rel="stylesheet">
</head>
<body>
	<div class="container my-4">
		<div class="d-flex justify-content-between align-items-center mb-3">
			<h3>Project Progress</h3>
			<div class="d-flex gap-2">
				<a class="btn btn-outline-secondary" href="/pages/leader_dashboard.html">Back</a>
				<button class="btn btn-dark" id="logoutBtn">Logout</button>
			</div>
		</div>
		<div id="content"></div>
	</div>
	<script>
	const params = new URLSearchParams(location.search);
	const projectId = params.get('project');
	async function guard(){
		const res = await fetch('/api/auth/me', { credentials:'include' });
		if (!res.ok) { window.location.href='/pages/login.html'; return false; }
		const me = await res.json();
		if (me.role !== 'leader' && me.role !== 'admin') { window.location.href='/pages/error.html'; return false; }
		return true;
	}
	async function load(){
		const [project, modules] = await Promise.all([
			fetch('/api/projects', { credentials:'include' }).then(r=>r.json()).then(list=>list.find(p=>String(p.id)===String(projectId)) || {}),
			fetch(`/api/projects/${projectId}/modules`, { credentials:'include' }).then(r=>r.json())
		]);
		document.getElementById('content').innerHTML = `
			<div class='mb-3'><h5>${project.title || ''}</h5>
			<div class='progress' style='height:10px; max-width:400px'><div class='progress-bar' style='width:${project.progress || 0}%'></div></div></div>
			<h6>Modules</h6>
			${modules.map(m=>`<div class='d-flex justify-content-between align-items-center mb-2'>
				<span>${m.module_name}</span>
				<div class='progress' style='height:8px; width:300px'><div class='progress-bar bg-success' style='width:${m.progress || 0}%'></div></div>
			</div>`).join('')}
		`;
	}
	guard().then(ok=>{ if (ok) load(); });
	document.getElementById('logoutBtn').onclick = async ()=>{
		await fetch('/api/auth/logout', { method:'POST', credentials:'include' });
		window.location.href = '/pages/login.html';
	};
	</script>
</body>
</html>
