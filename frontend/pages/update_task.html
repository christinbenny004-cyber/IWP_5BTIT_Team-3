<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Update Task</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

	<style>
		/* Background */
		body.page-bg {
			min-height: 100vh;
			background-image: url('https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=1950&q=80');
			background-size: cover;
			background-position: center;
			background-attachment: fixed;
			position: relative;
		}
		body.page-bg::before {
			content: "";
			position: fixed;
			inset: 0;
			background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.75));
			z-index: -1;
		}

		/* Glassmorphic task card */
		.task-card {
			background: rgba(255,255,255,0.08);
			backdrop-filter: blur(8px);
			-webkit-backdrop-filter: blur(8px);
			border: 1px solid rgba(255,255,255,0.15);
			border-radius: 12px;
			box-shadow: 0 6px 20px rgba(0,0,0,0.25);
			color: #f8f9fa;
			padding: 1rem;
			margin-bottom: 1rem;
			transition: transform 0.2s ease, box-shadow 0.2s ease;
		}
		.task-card:hover {
			transform: translateY(-4px);
			box-shadow: 0 10px 25px rgba(0,0,0,0.4);
		}
		.task-card strong {
			color: #fff;
		}
		.task-card .small {
			color: #b0bec5;
		}

		/* Dropdown styling */
		.form-select {
			background-color: rgba(255,255,255,0.15);
			color: #fff;
			border: 1px solid rgba(255,255,255,0.25);
		}
		.form-select option {
			color: #000;
		}

		/* Header */
		.page-header {
			color: #fff;
			text-shadow: 0 2px 6px rgba(0,0,0,0.5);
		}
	</style>
</head>
<body class="page-bg">
	<div class="container my-4">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h3 class="page-header">Update My Tasks</h3>
			<div class="d-flex gap-2">
				<a class="btn btn-outline-light" href="/pages/member_dashboard.html">Back</a>
				<button class="btn btn-light" id="logoutBtn">Logout</button>
			</div>
		</div>
		<div id="tasks"></div>
	</div>

	<script>
	async function guard(){
		const res = await fetch('/api/auth/me', { credentials:'include' });
		if (!res.ok) { window.location.href='/pages/login.html'; return false; }
		return true;
	}
	async function load(){
		const res = await fetch('/api/projects/my-tasks', { credentials:'include' });
		if (!res.ok) { alert('Unauthorized'); window.location.href='/pages/login.html'; return; }
		const list = await res.json();
		document.getElementById('tasks').innerHTML = list.map(t=>`
			<div class='task-card d-flex justify-content-between align-items-center'>
				<div>
					<div class='small text-muted'>${t.project_title} / ${t.module_name}</div>
					<strong>${t.task_name}</strong>
				</div>
				<select class='form-select form-select-sm w-auto' data-updatestatus='${t.id}'>
					<option ${t.status==='pending'?'selected':''}>pending</option>
					<option ${t.status==='in-progress'?'selected':''}>in-progress</option>
					<option ${t.status==='completed'?'selected':''}>completed</option>
				</select>
			</div>
		`).join('');
	}
	document.addEventListener('change', async (e)=>{
		if (e.target.dataset.updatestatus){
			await fetch(`/api/projects/tasks/${e.target.dataset.updatestatus}`, {
				method:'PUT',
				headers:{'Content-Type':'application/json'},
				credentials:'include',
				body: JSON.stringify({ status: e.target.value })
			});
			load();
		}
	});
	document.getElementById('logoutBtn').onclick = async ()=>{
		await fetch('/api/auth/logout', { method:'POST', credentials:'include' });
		window.location.href = '/pages/login.html';
	};
	guard().then(ok=>{ if (ok) load(); });
	</script>
</body>
</html>
