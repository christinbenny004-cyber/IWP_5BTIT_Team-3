<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Manage Modules</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

	<style>
		/* Background Styling */
		body {
			background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),
			            url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1920&q=80')
			            no-repeat center center fixed;
			background-size: cover;
			color: #f8f9fa;
			font-family: "Segoe UI", sans-serif;
		}

		/* Page Container */
		.container {
			background: rgba(255, 255, 255, 0.1);
			backdrop-filter: blur(8px);
			padding: 20px;
			border-radius: 15px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.4);
		}

		h3 {
			font-weight: bold;
			color: #fff;
		}

		/* Card Styling */
		.card {
			background: rgba(255, 255, 255, 0.15);
			backdrop-filter: blur(6px);
			border: none;
			border-radius: 12px;
			transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
		}
		.card:hover {
			transform: translateY(-5px);
			box-shadow: 0 6px 20px rgba(0,0,0,0.5);
		}
		.card-body strong {
			color: #fff;
		}
		.card-body span {
			color: #ffc107;
			font-weight: 600;
		}

		/* Buttons */
		.btn {
			border-radius: 8px;
			font-weight: 500;
		}
		.btn-primary {
			background: #0d6efd;
			border: none;
		}
		.btn-primary:hover {
			background: #0b5ed7;
		}
		.btn-dark:hover {
			background: #212529;
			color: #f8f9fa;
		}

		/* Input field */
		.input-group .form-control {
			border-radius: 8px 0 0 8px;
			border: none;
		}
	</style>
</head>
<body>
	<div class="container my-5">
		<div class="d-flex justify-content-between align-items-center mb-4">
			<h3>ðŸ“‚ Manage Modules</h3>
			<div class="d-flex gap-2">
				<a class="btn btn-outline-light" href="/pages/leader_dashboard.html">â¬… Back</a>
				<button class="btn btn-dark" id="logoutBtn">Logout</button>
			</div>
		</div>

		<div class="input-group mb-4">
			<input class="form-control" id="module_name" placeholder="Enter new module name">
			<button class="btn btn-primary" id="add">+ Add Module</button>
		</div>

		<div id="modules"></div>
	</div>

	<script>
	const params = new URLSearchParams(location.search);
	const projectId = params.get('project');
	async function guard(){
		const res = await fetch('/api/auth/me', { credentials:'include' });
		if (!res.ok) { window.location.href='/pages/login.html'; return false; }
		const me = await res.json();
		if (me.role !== 'leader' && me.role !== 'admin') { window.location.href='/pages/error.html'; return false; }
		return true;
	}
	async function load(){
		const res = await fetch(`/api/projects/${projectId}/modules`, { credentials:'include' });
		if (!res.ok) { alert('Unauthorized'); window.location.href='/pages/login.html'; return; }
		const list = await res.json();
		document.getElementById('modules').innerHTML = list.map(m=>`
			<div class='card mb-3'>
				<div class='card-body'>
					<div class='d-flex justify-content-between'>
						<strong>${m.module_name}</strong>
						<span>${m.progress || 0}%</span>
					</div>
					<a class='btn btn-sm btn-outline-light mt-3' href='/pages/assign_tasks.html?module=${m.id}&project=${projectId}'>Assign Tasks</a>
				</div>
			</div>`).join('');
	}
	document.getElementById('add').onclick = async ()=>{
		await fetch(`/api/projects/${projectId}/modules`, { 
			method:'POST', 
			headers:{'Content-Type':'application/json'}, 
			credentials:'include', 
			body: JSON.stringify({ module_name: module_name.value }) 
		});
		load();
	};
	document.getElementById('logoutBtn').onclick = async ()=>{
		await fetch('/api/auth/logout', { method:'POST', credentials:'include' });
		window.location.href = '/pages/login.html';
	};
	guard().then(ok=>{ if (ok) load(); });
	</script>
</body>
</html>
